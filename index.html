<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RomiSIM - Instant eSIMs</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    }
    .backdrop-blur {
      backdrop-filter: blur(10px);
    }
  </style>
</head>
<body class="bg-black text-white">
  <div id="app"></div>

  <script type="module">
    import React from 'https://esm.sh/react@18.2.0';
    import ReactDOM from 'https://esm.sh/react-dom@18.2.0/client';
    import { Globe, Zap, Shield, Check, X } from 'https://esm.sh/lucide-react@0.263.1';

    const { useState, useEffect } = React;

    function RomiSIMApp() {
      const [plans, setPlans] = useState([]);
      const [loadingPlans, setLoadingPlans] = useState(false);
      const [selectedPlan, setSelectedPlan] = useState(null);
      const [showCheckout, setShowCheckout] = useState(false);
      const [phone, setPhone] = useState('');
      const [email, setEmail] = useState('');
      const [orderLoading, setOrderLoading] = useState(false);
      const [orderResult, setOrderResult] = useState(null);
      const [error, setError] = useState('');
      const [countries, setCountries] = useState([]);
      const [selectedCountry, setSelectedCountry] = useState('all');

      const DEMO_MODE = true;
      const BACKEND_BASE = 'https://your-backend.example';

      const mockPlans = [
        { id: '1', name: 'Starter', country: 'Nigeria', data: '1GB', duration: '7 days', price: 9, speed: '4G LTE' },
        { id: '2', name: 'Basic', country: 'Nigeria', data: '3GB', duration: '14 days', price: 19, speed: '4G LTE' },
        { id: '3', name: 'Premium', country: 'Nigeria', data: '10GB', duration: '30 days', price: 39, speed: '4G LTE' },
        { id: '4', name: 'Traveler', country: 'USA', data: '5GB', duration: '15 days', price: 29, speed: '5G' },
        { id: '5', name: 'Business', country: 'UK', data: '20GB', duration: '30 days', price: 49, speed: '5G' },
        { id: '6', name: 'Explorer', country: 'UAE', data: '8GB', duration: '21 days', price: 35, speed: '4G LTE' },
      ];

      useEffect(() => {
        loadPlans();
      }, []);

      async function loadPlans() {
        setLoadingPlans(true);
        try {
          if (DEMO_MODE) {
            await new Promise(resolve => setTimeout(resolve, 800));
            setPlans(mockPlans);
            const uniqueCountries = [...new Set(mockPlans.map(p => p.country))];
            setCountries(uniqueCountries);
          } else {
            const res = await fetch(`${BACKEND_BASE}/esim/plans`);
            if (!res.ok) throw new Error('Failed to load plans');
            const json = await res.json();
            setPlans(json.plans || []);
            const uniqueCountries = [...new Set((json.plans || []).map(p => p.country))];
            setCountries(uniqueCountries);
          }
        } catch (e) {
          console.error(e);
          setError('Unable to load plans. Please try again.');
        } finally {
          setLoadingPlans(false);
        }
      }

      function openCheckout(plan) {
        setSelectedPlan(plan);
        setShowCheckout(true);
        setError('');
        setOrderResult(null);
      }

      async function handlePayment() {
        if (!email || !email.includes('@')) {
          setError('Please enter a valid email address');
          return;
        }

        if (!phone) {
          setError('Please enter your phone number');
          return;
        }

        setOrderLoading(true);
        setError('');
        setOrderResult(null);

        try {
          if (DEMO_MODE) {
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            const mockResult = {
              orderId: `ORD-${Date.now()}`,
              esim: {
                qr_url: `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=LPA:1$example.com$${Date.now()}`,
                iccid: `8944${Math.random().toString().slice(2, 17)}`,
                instructions: '1. Go to Settings → Cellular/Mobile Data\n2. Tap "Add eSIM"\n3. Scan this QR code\n4. Follow on-screen prompts to activate',
                activationCode: `LPA:1$example.com$${Date.now()}`
              },
              status: 'completed'
            };
            
            setOrderResult(mockResult);
            setShowCheckout(false);
            setOrderLoading(false);
            return;
          }

          const payload = {
            planId: selectedPlan.id,
            phone,
            email,
          };

          const res = await fetch(`${BACKEND_BASE}/orders/create`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload),
          });

          const json = await res.json();
          if (!res.ok) throw new Error(json.message || 'Order creation failed');

          if (json.paystack?.authorization_url) {
            window.location.href = json.paystack.authorization_url;
            return;
          }

          if (json.paystack?.reference) {
            const handler = window.PaystackPop?.setup({
              key: 'YOUR_PAYSTACK_PUBLIC_KEY',
              email: email,
              amount: Math.round(selectedPlan.price * 100),
              reference: json.paystack.reference,
              onClose: function(){ 
                setError('Payment window closed'); 
                setOrderLoading(false);
              },
              callback: function(response){
                verifyPayment(json.orderId, response.reference);
              }
            });

            if (handler) {
              handler.openIframe();
            } else if (json.paystack.authorization_url) {
              window.location.href = json.paystack.authorization_url;
            } else {
              throw new Error('Unable to open Paystack');
            }
          } else {
            setOrderResult(json);
            setShowCheckout(false);
          }
        } catch (err) {
          console.error(err);
          setError(err.message || 'Payment failed. Please try again.');
        } finally {
          setOrderLoading(false);
        }
      }

      async function verifyPayment(orderId, reference) {
        try {
          const res = await fetch(`${BACKEND_BASE}/orders/verify`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ orderId, reference }),
          });
          const json = await res.json();
          if (!res.ok) throw new Error(json.message || 'Verification failed');
          setOrderResult(json);
          setShowCheckout(false);
        } catch (e) {
          console.error(e);
          setError('Payment verification failed. Please contact support.');
        }
      }

      const filteredPlans = selectedCountry === 'all' 
        ? plans 
        : plans.filter(p => p.country === selectedCountry);

      return React.createElement('div', { className: 'min-h-screen bg-black text-white font-sans' },
        // Header
        React.createElement('header', { className: 'border-b border-white/5 sticky top-0 bg-black/95 backdrop-blur z-40' },
          React.createElement('div', { className: 'max-w-6xl mx-auto px-6 py-4 flex items-center justify-between' },
            React.createElement('div', { className: 'flex items-center gap-3' },
              React.createElement('div', { className: 'w-10 h-10 bg-white text-black rounded-lg flex items-center justify-center font-bold text-xl' }, 'R'),
              React.createElement('div', { className: 'text-xl font-semibold' }, 'RomiSIM')
            ),
            React.createElement('nav', { className: 'hidden md:flex items-center gap-6 text-sm' },
              React.createElement('a', { href: '#plans', className: 'hover:text-gray-300 transition-colors' }, 'Plans'),
              React.createElement('a', { href: '#how', className: 'hover:text-gray-300 transition-colors' }, 'How it works'),
              React.createElement('a', { href: '#support', className: 'hover:text-gray-300 transition-colors' }, 'Support')
            )
          )
        ),

        // Hero
        React.createElement('section', { className: 'max-w-6xl mx-auto px-6 py-16 md:py-24' },
          React.createElement('div', { className: 'flex flex-col md:flex-row items-center gap-12' },
            React.createElement('div', { className: 'flex-1 text-center md:text-left' },
              React.createElement('h1', { className: 'text-4xl md:text-5xl lg:text-6xl font-bold leading-tight' },
                'Instant eSIMs',
                React.createElement('br'),
                React.createElement('span', { className: 'text-gray-400' }, 'Simple, Secure, Global')
              ),
              React.createElement('p', { className: 'mt-6 text-lg text-gray-300 max-w-xl' },
                'Buy and activate eSIMs in seconds. Pay securely with Paystack. Travel data plans for every country, delivered instantly to your device.'
              ),
              React.createElement('div', { className: 'mt-8 flex flex-col sm:flex-row gap-4 justify-center md:justify-start' },
                React.createElement('button', { 
                  onClick: () => document.getElementById('plans')?.scrollIntoView({ behavior: 'smooth' }), 
                  className: 'bg-white text-black px-6 py-3 rounded-lg font-medium hover:bg-gray-100 transition-colors'
                }, 'Browse Plans'),
                React.createElement('a', { 
                  href: '#how', 
                  className: 'px-6 py-3 border border-white/20 rounded-lg hover:border-white/40 transition-colors text-center'
                }, 'How it works')
              ),
              React.createElement('div', { className: 'mt-12 grid grid-cols-3 gap-6 max-w-md mx-auto md:mx-0' },
                React.createElement('div', { className: 'text-center md:text-left' },
                  React.createElement(Zap, { className: 'w-6 h-6 mx-auto md:mx-0 mb-2' }),
                  React.createElement('div', { className: 'text-xs text-gray-400' }, 'Instant', React.createElement('br'), 'Activation')
                ),
                React.createElement('div', { className: 'text-center md:text-left' },
                  React.createElement(Shield, { className: 'w-6 h-6 mx-auto md:mx-0 mb-2' }),
                  React.createElement('div', { className: 'text-xs text-gray-400' }, 'Secure', React.createElement('br'), 'Payments')
                ),
                React.createElement('div', { className: 'text-center md:text-left' },
                  React.createElement(Globe, { className: 'w-6 h-6 mx-auto md:mx-0 mb-2' }),
                  React.createElement('div', { className: 'text-xs text-gray-400' }, 'Global', React.createElement('br'), 'Coverage')
                )
              )
            ),
            React.createElement('div', { className: 'w-full md:w-80 lg:w-96 bg-gradient-to-br from-white/10 to-white/5 border border-white/10 rounded-2xl p-8 backdrop-blur' },
              React.createElement('div', { className: 'text-sm text-gray-300 font-medium' }, 'Featured Plan'),
              React.createElement('div', { className: 'mt-6 flex items-baseline gap-3' },
                React.createElement('div', { className: 'text-5xl font-bold' }, '$9'),
                React.createElement('div', { className: 'text-sm text-gray-400' }, 'USD')
              ),
              React.createElement('div', { className: 'mt-2 text-gray-300' }, '1GB · 7 days · Nigeria'),
              React.createElement('ul', { className: 'mt-6 space-y-3' },
                React.createElement('li', { className: 'flex items-center gap-2 text-sm text-gray-300' },
                  React.createElement(Check, { className: 'w-4 h-4' }),
                  React.createElement('span', null, 'Instant QR delivery')
                ),
                React.createElement('li', { className: 'flex items-center gap-2 text-sm text-gray-300' },
                  React.createElement(Check, { className: 'w-4 h-4' }),
                  React.createElement('span', null, '4G LTE speeds')
                ),
                React.createElement('li', { className: 'flex items-center gap-2 text-sm text-gray-300' },
                  React.createElement(Check, { className: 'w-4 h-4' }),
                  React.createElement('span', null, 'Easy setup')
                )
              ),
              React.createElement('button', { 
                onClick: () => openCheckout(mockPlans[0]),
                className: 'mt-8 bg-white text-black px-6 py-3 rounded-lg font-medium w-full hover:bg-gray-100 transition-colors'
              }, 'Get Started')
            )
          )
        ),

        // Plans
        React.createElement('section', { id: 'plans', className: 'max-w-6xl mx-auto px-6 py-16 border-t border-white/5' },
          React.createElement('div', { className: 'flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8' },
            React.createElement('h2', { className: 'text-3xl font-bold' }, 'Available Plans'),
            React.createElement('div', { className: 'flex items-center gap-3' },
              React.createElement('label', { className: 'text-sm text-gray-400' }, 'Filter by country:'),
              React.createElement('select', { 
                value: selectedCountry,
                onChange: (e) => setSelectedCountry(e.target.value),
                className: 'bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-sm focus:outline-none focus:border-white/30'
              },
                React.createElement('option', { value: 'all' }, 'All Countries'),
                countries.map(country => 
                  React.createElement('option', { key: country, value: country }, country)
                )
              )
            )
          ),
          loadingPlans ? 
            React.createElement('div', { className: 'flex items-center justify-center py-20' },
              React.createElement('div', { className: 'text-gray-400' }, 'Loading plans...')
            )
          :
            React.createElement('div', { className: 'grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6' },
              filteredPlans.length === 0 && 
                React.createElement('div', { className: 'col-span-full text-center py-20 text-gray-400' },
                  'No plans available for the selected country.'
                ),
              filteredPlans.map(plan => 
                React.createElement('div', { 
                  key: plan.id, 
                  className: 'p-6 bg-white/3 border border-white/10 rounded-xl hover:border-white/20 transition-all hover:bg-white/5'
                },
                  React.createElement('div', { className: 'flex items-start justify-between' },
                    React.createElement('div', null,
                      React.createElement('div', { className: 'text-xl font-semibold' }, plan.name),
                      React.createElement('div', { className: 'text-sm text-gray-400 mt-1' }, plan.country)
                    ),
                    React.createElement('div', { className: 'text-right' },
                      React.createElement('div', { className: 'text-3xl font-bold' }, '$', plan.price)
                    )
                  ),
                  React.createElement('div', { className: 'mt-6 space-y-2' },
                    React.createElement('div', { className: 'flex items-center justify-between text-sm' },
                      React.createElement('span', { className: 'text-gray-400' }, 'Data'),
                      React.createElement('span', { className: 'font-medium' }, plan.data)
                    ),
                    React.createElement('div', { className: 'flex items-center justify-between text-sm' },
                      React.createElement('span', { className: 'text-gray-400' }, 'Duration'),
                      React.createElement('span', { className: 'font-medium' }, plan.duration)
                    ),
                    React.createElement('div', { className: 'flex items-center justify-between text-sm' },
                      React.createElement('span', { className: 'text-gray-400' }, 'Speed'),
                      React.createElement('span', { className: 'font-medium' }, plan.speed || 'Standard')
                    )
                  ),
                  React.createElement('div', { className: 'mt-6' },
                    React.createElement('button', { 
                      onClick: () => openCheckout(plan), 
                      className: 'w-full bg-white text-black px-4 py-2.5 rounded-lg font-medium hover:bg-gray-100 transition-colors'
                    }, 'Buy Now')
                  )
                )
              )
            )
        ),

        // How it works
        React.createElement('section', { id: 'how', className: 'max-w-6xl mx-auto px-6 py-16 border-t border-white/5' },
          React.createElement('h3', { className: 'text-3xl font-bold mb-12 text-center' }, 'How RomiSIM Works'),
          React.createElement('div', { className: 'grid md:grid-cols-4 gap-8' },
            [
              { num: '1', title: 'Choose Plan', desc: 'Select a country and data plan that fits your needs' },
              { num: '2', title: 'Pay Securely', desc: 'Complete payment safely through Paystack' },
              { num: '3', title: 'Get QR Code', desc: 'Receive your eSIM QR code instantly via email' },
              { num: '4', title: 'Activate', desc: 'Scan the QR on your device and start using data' }
            ].map((step) =>
              React.createElement('div', { key: step.num, className: 'text-center' },
                React.createElement('div', { className: 'w-12 h-12 bg-white text-black rounded-full flex items-center justify-center text-xl font-bold mx-auto mb-4' }, step.num),
                React.createElement('h4', { className: 'font-semibold mb-2' }, step.title),
                React.createElement('p', { className: 'text-sm text-gray-400' }, step.desc)
              )
            )
          )
        ),

        // Footer
        React.createElement('footer', { id: 'support', className: 'max-w-6xl mx-auto px-6 py-12 border-t border-white/5' },
          React.createElement('div', { className: 'flex flex-col md:flex-row items-center justify-between gap-4 text-sm text-gray-400' },
            React.createElement('div', { className: 'flex items-center gap-3' },
              React.createElement('div', { className: 'w-8 h-8 bg-white text-black rounded flex items-center justify-center font-bold' }, 'R'),
              React.createElement('span', null, `© ${new Date().getFullYear()} RomiSIM. All rights reserved.`)
            ),
            React.createElement('div', { className: 'flex items-center gap-6' },
              React.createElement('a', { href: 'mailto:support@romisim.example', className: 'hover:text-white transition-colors' }, 'support@romisim.example'),
              React.createElement('a', { href: '#', className: 'hover:text-white transition-colors' }, 'Privacy'),
              React.createElement('a', { href: '#', className: 'hover:text-white transition-colors' }, 'Terms')
            )
          )
        ),

        // Checkout Modal
        showCheckout && selectedPlan &&
          React.createElement('div', { className: 'fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4' },
            React.createElement('div', { className: 'w-full max-w-md bg-black border border-white/20 rounded-2xl p-8 shadow-2xl' },
              React.createElement('div', { className: 'flex items-start justify-between mb-6' },
                React.createElement('div', null,
                  React.createElement('h4', { className: 'text-2xl font-bold' }, selectedPlan.name),
                  React.createElement('p', { className: 'text-sm text-gray-400 mt-1' },
                    `${selectedPlan.country} · ${selectedPlan.data} · ${selectedPlan.duration}`
                  )
                ),
                React.createElement('button', { 
                  onClick: () => setShowCheckout(false),
                  className: 'text-gray-400 hover:text-white',
                  'aria-label': 'Close'
                }, React.createElement(X, { className: 'w-6 h-6' }))
              ),
              React.createElement('div', { className: 'mb-6 p-4 bg-white/5 rounded-lg border border-white/10' },
                React.createElement('div', { className: 'flex items-center justify-between' },
                  React.createElement('span', { className: 'text-gray-400' }, 'Total'),
                  React.createElement('span', { className: 'text-3xl font-bold' }, '$', selectedPlan.price)
                )
              ),
              React.createElement('div', { className: 'space-y-4' },
                React.createElement('div', null,
                  React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'Phone Number'),
                  React.createElement('input', { 
                    type: 'tel',
                    value: phone, 
                    onChange: (e) => setPhone(e.target.value), 
                    placeholder: '+2348012345678', 
                    className: 'w-full p-3 bg-white/5 border border-white/10 rounded-lg focus:outline-none focus:border-white/30 transition-colors' 
                  })
                ),
                React.createElement('div', null,
                  React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'Email Address'),
                  React.createElement('input', { 
                    type: 'email',
                    value: email, 
                    onChange: (e) => setEmail(e.target.value), 
                    placeholder: 'you@example.com', 
                    className: 'w-full p-3 bg-white/5 border border-white/10 rounded-lg focus:outline-none focus:border-white/30 transition-colors' 
                  }),
                  React.createElement('p', { className: 'mt-1 text-xs text-gray-500' }, 'Your eSIM QR code will be sent here')
                ),
                error &&
                  React.createElement('div', { className: 'p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-red-400 text-sm' }, error),
                React.createElement('button', { 
                  onClick: handlePayment,
                  disabled: orderLoading, 
                  className: 'w-full bg-white text-black px-6 py-3 rounded-lg font-medium hover:bg-gray-100 transition-colors disabled:opacity-50 disabled:cursor-not-allowed'
                }, orderLoading ? 'Processing...' : `Pay $${selectedPlan.price}`)
              ),
              React.createElement('p', { className: 'mt-6 text-xs text-gray-500 text-center' },
                'By purchasing you agree to our ',
                React.createElement('a', { href: '#', className: 'underline' }, 'Terms'),
                ' & ',
                React.createElement('a', { href: '#', className: 'underline' }, 'Privacy Policy')
              )
            )
          ),

        // Success Panel
        orderResult &&
          React.createElement('div', { className: 'fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4' },
            React.createElement('div', { className: 'w-full max-w-lg bg-gradient-to-br from-green-500/10 to-blue-500/10 border border-white/20 rounded-2xl p-8 shadow-2xl' },
              React.createElement('div', { className: 'text-center mb-6' },
                React.createElement('div', { className: 'w-16 h-16 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-4' },
                  React.createElement(Check, { className: 'w-8 h-8 text-white' })
                ),
                React.createElement('h3', { className: 'text-2xl font-bold' }, 'eSIM Ready!'),
                React.createElement('p', { className: 'text-gray-400 mt-2' }, 'Your eSIM has been successfully activated')
              ),
              orderResult.esim &&
                React.createElement('div', { className: 'space-y-6' },
                  React.createElement('div', { className: 'bg-white p-4 rounded-xl' },
                    React.createElement('img', { 
                      src: orderResult.esim.qr_url, 
                      alt: 'eSIM QR Code', 
                      className: 'w-full rounded-lg'
                    })
                  ),
                  React.createElement('div', { className: 'bg-white/5 border border-white/10 rounded-lg p-4' },
                    React.createElement('h4', { className: 'font-semibold mb-2' }, 'Activation Steps:'),
                    React.createElement('p', { className: 'text-sm text-gray-300 whitespace-pre-line' }, orderResult.esim.instructions)
                  ),
                  orderResult.esim.iccid &&
                    React.createElement('div', { className: 'bg-white/5 border border-white/10 rounded-lg p-4' },
                      React.createElement('div', { className: 'text-xs text-gray-400 mb-1' }, 'ICCID'),
                      React.createElement('div', { className: 'font-mono text-sm break-all' }, orderResult.esim.iccid)
                    ),
                  React.createElement('div', { className: 'flex gap-3' },
                    React.createElement('button', { 
                      onClick: () => {
                        const link = document.createElement('a');
                        link.href = orderResult.esim.qr_url;
                        link.download = 'esim-qr-code.png';
                        link.click();
                      },
                      className: 'flex-1 bg-white text-black px-4 py-3 rounded-lg font-medium hover:bg-gray-100 transition-colors'
                    }, 'Download QR'),
                    React.createElement('button', { 
                      onClick: () => setOrderResult(null), 
                      className: 'flex-1 border border-white/20 px-4 py-3 rounded-lg hover:bg-white/5 transition-colors'
                    }, 'Close')
                  )
                )
            )
          )
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('app'));
    root.render(React.createElement(RomiSIMApp));
  </script>

  <!-- Optional: Add Paystack inline script for production -->
  <!-- <script src="https://js.paystack.co/v1/inline.js"></script> -->
</body>
</html>
