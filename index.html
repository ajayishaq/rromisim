<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>romiSIM - Instant eSIMs</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    }
    .backdrop-blur {
      backdrop-filter: blur(10px);
    }
    html {
      scroll-behavior: smooth;
    }
    .logo-text {
      font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
      font-size: 28px;
      font-weight: 700;
      letter-spacing: -0.5px;
      background: linear-gradient(135deg, #ffffff 0%, #e5e5e5 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
  </style>
</head>
<body class="bg-black text-white">
  <div id="app"></div>

  <script type="module">
    import React from 'https://esm.sh/react@18.2.0';
    import ReactDOM from 'https://esm.sh/react-dom@18.2.0/client';
    import { Globe, Zap, Shield, Check, X, AlertCircle, Loader, Menu, LogOut } from 'https://esm.sh/lucide-react@0.263.1';

    const { useState, useEffect } = React;

    function RomiSIMApp() {
      const [plans, setPlans] = useState([]);
      const [loadingPlans, setLoadingPlans] = useState(false);
      const [selectedPlan, setSelectedPlan] = useState(null);
      const [showCheckout, setShowCheckout] = useState(false);
      const [phone, setPhone] = useState('');
      const [email, setEmail] = useState('');
      const [orderLoading, setOrderLoading] = useState(false);
      const [orderResult, setOrderResult] = useState(null);
      const [error, setError] = useState('');
      const [countries, setCountries] = useState([]);
      const [selectedCountry, setSelectedCountry] = useState('all');
      const [mobileMenuOpen, setMobileMenuOpen] = useState(false);

      const BACKEND_BASE = window.location.origin;

      useEffect(() => {
        loadPlans();
      }, []);

      async function loadPlans() {
        setLoadingPlans(true);
        try {
          const res = await fetch(`${BACKEND_BASE}/api/plans`);
          if (!res.ok) throw new Error('Failed to load plans');
          const json = await res.json();
          setPlans(json.plans || []);
          const uniqueCountries = [...new Set((json.plans || []).map(p => p.country))].sort();
          setCountries(uniqueCountries);
        } catch (e) {
          console.error(e);
          setError('Unable to load plans. Please try again.');
        } finally {
          setLoadingPlans(false);
        }
      }

      function openCheckout(plan) {
        setSelectedPlan(plan);
        setShowCheckout(true);
        setError('');
        setOrderResult(null);
        setPhone('');
        setEmail('');
      }

      async function handlePayment() {
        if (!email || !email.includes('@')) {
          setError('Please enter a valid email address');
          return;
        }

        if (!phone || phone.length < 10) {
          setError('Please enter a valid phone number');
          return;
        }

        setOrderLoading(true);
        setError('');
        setOrderResult(null);

        try {
          const payload = {
            planId: selectedPlan.id,
            phone,
            email,
          };

          const res = await fetch(`${BACKEND_BASE}/api/orders/create`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload),
          });

          const json = await res.json();
          if (!res.ok) throw new Error(json.error || json.details || 'Order creation failed');

          if (json.paystack?.authorization_url) {
            window.location.href = json.paystack.authorization_url;
            return;
          }

          setOrderResult(json);
          setShowCheckout(false);
        } catch (err) {
          console.error(err);
          setError(err.message || 'Payment failed. Please try again.');
        } finally {
          setOrderLoading(false);
        }
      }

      const filteredPlans = selectedCountry === 'all' 
        ? plans 
        : plans.filter(p => p.country === selectedCountry);

      return React.createElement('div', { className: 'min-h-screen bg-black text-white font-sans' },
        React.createElement('header', { className: 'border-b border-white/5 sticky top-0 bg-black/95 backdrop-blur z-40' },
          React.createElement('div', { className: 'max-w-6xl mx-auto px-6 py-4 flex items-center justify-between' },
            React.createElement('div', { className: 'flex items-center gap-3' },
              React.createElement('div', { className: 'logo-text' }, 'romiSIM')
            ),
            React.createElement('nav', { className: 'hidden md:flex items-center gap-8 text-sm' },
              React.createElement('a', { href: '#plans', className: 'hover:text-gray-300 transition-colors' }, 'Plans'),
              React.createElement('a', { href: '#how', className: 'hover:text-gray-300 transition-colors' }, 'How it works'),
              React.createElement('a', { href: '#support', className: 'hover:text-gray-300 transition-colors' }, 'Support')
            ),
            React.createElement('div', { className: 'md:hidden' },
              React.createElement('button', { 
                onClick: () => setMobileMenuOpen(!mobileMenuOpen),
                className: 'text-white'
              }, React.createElement(Menu, { className: 'w-6 h-6' }))
            )
          ),
          mobileMenuOpen && React.createElement('div', { className: 'md:hidden border-t border-white/5 px-6 py-4 space-y-3' },
            React.createElement('a', { href: '#plans', className: 'block hover:text-gray-300 text-sm' }, 'Plans'),
            React.createElement('a', { href: '#how', className: 'block hover:text-gray-300 text-sm' }, 'How it works'),
            React.createElement('a', { href: '#support', className: 'block hover:text-gray-300 text-sm' }, 'Support')
          )
        ),

        React.createElement('section', { className: 'max-w-6xl mx-auto px-6 py-16 md:py-24' },
          React.createElement('div', { className: 'flex flex-col md:flex-row items-center gap-12' },
            React.createElement('div', { className: 'flex-1 text-center md:text-left' },
              React.createElement('h1', { className: 'text-5xl md:text-6xl lg:text-7xl font-bold leading-tight' },
                'Instant eSIMs',
                React.createElement('br'),
                React.createElement('span', { className: 'text-gray-400 text-4xl md:text-5xl lg:text-6xl' }, 'Global Coverage')
              ),
              React.createElement('p', { className: 'mt-6 text-lg text-gray-300 max-w-xl' },
                'Buy and activate eSIMs in seconds. Pay securely with Paystack. Travel data plans for 200+ destinations, delivered instantly to your email.'
              ),
              React.createElement('div', { className: 'mt-8 flex flex-col sm:flex-row gap-4 justify-center md:justify-start' },
                React.createElement('button', { 
                  onClick: () => document.getElementById('plans')?.scrollIntoView({ behavior: 'smooth' }), 
                  className: 'bg-white text-black px-6 py-3 rounded-lg font-medium hover:bg-gray-100 transition-colors'
                }, 'Browse Plans'),
                React.createElement('a', { 
                  href: '#how', 
                  className: 'px-6 py-3 border border-white/20 rounded-lg hover:border-white/40 transition-colors text-center'
                }, 'How it works')
              ),
              React.createElement('div', { className: 'mt-12 grid grid-cols-3 gap-6 max-w-md mx-auto md:mx-0' },
                React.createElement('div', { className: 'text-center md:text-left' },
                  React.createElement(Zap, { className: 'w-6 h-6 mx-auto md:mx-0 mb-2' }),
                  React.createElement('div', { className: 'text-xs text-gray-400' }, 'Instant', React.createElement('br'), 'Delivery')
                ),
                React.createElement('div', { className: 'text-center md:text-left' },
                  React.createElement(Shield, { className: 'w-6 h-6 mx-auto md:mx-0 mb-2' }),
                  React.createElement('div', { className: 'text-xs text-gray-400' }, 'Secure', React.createElement('br'), 'Payments')
                ),
                React.createElement('div', { className: 'text-center md:text-left' },
                  React.createElement(Globe, { className: 'w-6 h-6 mx-auto md:mx-0 mb-2' }),
                  React.createElement('div', { className: 'text-xs text-gray-400' }, '200+', React.createElement('br'), 'Countries')
                )
              )
            ),
            React.createElement('div', { className: 'w-full md:w-80 lg:w-96 bg-gradient-to-br from-white/10 to-white/5 border border-white/10 rounded-2xl p-8 backdrop-blur' },
              React.createElement('div', { className: 'text-sm text-gray-300 font-medium' }, 'Popular Plan'),
              plans.length > 0 && React.createElement(
                React.Fragment,
                null,
                React.createElement('div', { className: 'mt-6 flex items-baseline gap-3' },
                  React.createElement('div', { className: 'text-5xl font-bold' }, '$', plans[0].price.toFixed(2)),
                  React.createElement('div', { className: 'text-sm text-gray-400' }, 'USD')
                ),
                React.createElement('div', { className: 'mt-2 text-gray-300' }, `${plans[0].data} · ${plans[0].duration} · ${plans[0].country}`),
                React.createElement('ul', { className: 'mt-6 space-y-3' },
                  React.createElement('li', { className: 'flex items-center gap-2 text-sm text-gray-300' },
                    React.createElement(Check, { className: 'w-4 h-4' }),
                    React.createElement('span', null, 'Instant QR delivery')
                  ),
                  React.createElement('li', { className: 'flex items-center gap-2 text-sm text-gray-300' },
                    React.createElement(Check, { className: 'w-4 h-4' }),
                    React.createElement('span', null, 'Email delivery')
                  ),
                  React.createElement('li', { className: 'flex items-center gap-2 text-sm text-gray-300' },
                    React.createElement(Check, { className: 'w-4 h-4' }),
                    React.createElement('span', null, 'Easy setup')
                  )
                ),
                React.createElement('button', { 
                  onClick: () => openCheckout(plans[0]),
                  className: 'mt-8 bg-white text-black px-6 py-3 rounded-lg font-medium w-full hover:bg-gray-100 transition-colors'
                }, 'Get Started')
              )
            )
          )
        ),

        React.createElement('section', { id: 'plans', className: 'max-w-6xl mx-auto px-6 py-16 border-t border-white/5' },
          React.createElement('div', { className: 'flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8' },
            React.createElement('h2', { className: 'text-3xl font-bold' }, 'Available Plans'),
            React.createElement('div', { className: 'flex items-center gap-3' },
              React.createElement('label', { className: 'text-sm text-gray-400' }, 'Filter by country:'),
              React.createElement('select', { 
                value: selectedCountry,
                onChange: (e) => setSelectedCountry(e.target.value),
                className: 'bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-sm text-white focus:outline-none focus:border-white/30'
              },
                React.createElement('option', { value: 'all' }, 'All Countries'),
                countries.map(country => 
                  React.createElement('option', { key: country, value: country }, country)
                )
              )
            )
          ),
          loadingPlans ? 
            React.createElement('div', { className: 'flex items-center justify-center py-20' },
              React.createElement('div', { className: 'text-gray-400' }, 'Loading plans...')
            )
          :
            React.createElement('div', { className: 'grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6' },
              filteredPlans.length === 0 && 
                React.createElement('div', { className: 'col-span-full text-center py-20 text-gray-400' },
                  'No plans available for the selected country.'
                ),
              filteredPlans.map(plan => 
                React.createElement('div', { 
                  key: plan.id, 
                  className: 'p-6 bg-white/3 border border-white/10 rounded-xl hover:border-white/20 transition-all hover:bg-white/5 group cursor-pointer'
                },
                  React.createElement('div', { className: 'flex items-start justify-between' },
                    React.createElement('div', null,
                      React.createElement('div', { className: 'text-xl font-semibold' }, plan.name),
                      React.createElement('div', { className: 'text-sm text-gray-400 mt-1' }, plan.country)
                    ),
                    React.createElement('div', { className: 'text-right' },
                      React.createElement('div', { className: 'text-3xl font-bold' }, '$', plan.price.toFixed(2))
                    )
                  ),
                  React.createElement('div', { className: 'mt-6 space-y-2' },
                    React.createElement('div', { className: 'flex items-center justify-between text-sm' },
                      React.createElement('span', { className: 'text-gray-400' }, 'Data'),
                      React.createElement('span', { className: 'font-medium' }, plan.data)
                    ),
                    React.createElement('div', { className: 'flex items-center justify-between text-sm' },
                      React.createElement('span', { className: 'text-gray-400' }, 'Duration'),
                      React.createElement('span', { className: 'font-medium' }, plan.duration)
                    ),
                    React.createElement('div', { className: 'flex items-center justify-between text-sm' },
                      React.createElement('span', { className: 'text-gray-400' }, 'Speed'),
                      React.createElement('span', { className: 'font-medium' }, plan.speed || 'Standard')
                    )
                  ),
                  React.createElement('div', { className: 'mt-6' },
                    React.createElement('button', { 
                      onClick: () => openCheckout(plan), 
                      className: 'w-full bg-white text-black px-4 py-2.5 rounded-lg font-medium hover:bg-gray-100 transition-colors group-hover:shadow-lg'
                    }, 'Buy Now')
                  )
                )
              )
            )
        ),

        React.createElement('section', { id: 'how', className: 'max-w-6xl mx-auto px-6 py-16 border-t border-white/5' },
          React.createElement('h3', { className: 'text-3xl font-bold mb-12 text-center' }, 'How romiSIM Works'),
          React.createElement('div', { className: 'grid md:grid-cols-4 gap-8' },
            [
              { num: '1', title: 'Choose Plan', desc: 'Select a country and data plan that fits your needs' },
              { num: '2', title: 'Pay Securely', desc: 'Complete payment safely through Paystack' },
              { num: '3', title: 'Get QR Code', desc: 'Receive your eSIM QR code instantly via email' },
              { num: '4', title: 'Activate', desc: 'Scan the QR on your device and start using data' }
            ].map((step) =>
              React.createElement('div', { key: step.num, className: 'text-center' },
                React.createElement('div', { className: 'w-12 h-12 bg-white text-black rounded-full flex items-center justify-center text-xl font-bold mx-auto mb-4' }, step.num),
                React.createElement('h4', { className: 'font-semibold mb-2' }, step.title),
                React.createElement('p', { className: 'text-sm text-gray-400' }, step.desc)
              )
            )
          )
        ),

        React.createElement('footer', { id: 'support', className: 'max-w-6xl mx-auto px-6 py-12 border-t border-white/5' },
          React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-3 gap-8 mb-12' },
            React.createElement('div', null,
              React.createElement('h4', { className: 'font-semibold mb-4' }, 'romiSIM'),
              React.createElement('p', { className: 'text-sm text-gray-400' }, 'Instant eSIM delivery worldwide')
            ),
            React.createElement('div', null,
              React.createElement('h4', { className: 'font-semibold mb-4' }, 'Quick Links'),
              React.createElement('ul', { className: 'space-y-2 text-sm text-gray-400' },
                React.createElement('li', null, React.createElement('a', { href: '#plans', className: 'hover:text-white transition-colors' }, 'Browse Plans')),
                React.createElement('li', null, React.createElement('a', { href: '#how', className: 'hover:text-white transition-colors' }, 'How it Works')),
                React.createElement('li', null, React.createElement('a', { href: '#support', className: 'hover:text-white transition-colors' }, 'Support'))
              )
            ),
            React.createElement('div', null,
              React.createElement('h4', { className: 'font-semibold mb-4' }, 'Legal'),
              React.createElement('ul', { className: 'space-y-2 text-sm text-gray-400' },
                React.createElement('li', null, React.createElement('a', { href: '/privacy', className: 'hover:text-white transition-colors' }, 'Privacy Policy')),
                React.createElement('li', null, React.createElement('a', { href: '/terms', className: 'hover:text-white transition-colors' }, 'Terms of Service')),
                React.createElement('li', null, React.createElement('a', { href: 'mailto:support@romisim.com', className: 'hover:text-white transition-colors' }, 'support@romisim.com'))
              )
            )
          ),
          React.createElement('div', { className: 'border-t border-white/5 pt-8 flex flex-col md:flex-row items-center justify-between text-sm text-gray-400' },
            React.createElement('span', null, `© ${new Date().getFullYear()} romiSIM. All rights reserved.`),
            React.createElement('span', null, 'Powered by eSIM Access')
          )
        ),

        showCheckout && selectedPlan &&
          React.createElement('div', { className: 'fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4' },
            React.createElement('div', { className: 'w-full max-w-md bg-black border border-white/20 rounded-2xl p-8 shadow-2xl' },
              React.createElement('div', { className: 'flex items-start justify-between mb-6' },
                React.createElement('div', null,
                  React.createElement('h4', { className: 'text-2xl font-bold' }, selectedPlan.name),
                  React.createElement('p', { className: 'text-sm text-gray-400 mt-1' },
                    `${selectedPlan.country} · ${selectedPlan.data} · ${selectedPlan.duration}`
                  )
                ),
                React.createElement('button', { 
                  onClick: () => setShowCheckout(false),
                  className: 'text-gray-400 hover:text-white',
                  'aria-label': 'Close'
                }, React.createElement(X, { className: 'w-6 h-6' }))
              ),
              React.createElement('div', { className: 'mb-6 p-4 bg-white/5 rounded-lg border border-white/10' },
                React.createElement('div', { className: 'flex items-center justify-between' },
                  React.createElement('span', { className: 'text-gray-400' }, 'Total'),
                  React.createElement('span', { className: 'text-3xl font-bold' }, '$', selectedPlan.price.toFixed(2))
                )
              ),
              React.createElement('div', { className: 'space-y-4' },
                React.createElement('div', null,
                  React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'Phone Number'),
                  React.createElement('input', { 
                    type: 'tel',
                    value: phone, 
                    onChange: (e) => setPhone(e.target.value), 
                    placeholder: '+2348012345678', 
                    className: 'w-full p-3 bg-white/5 border border-white/10 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-white/30 transition-colors' 
                  })
                ),
                React.createElement('div', null,
                  React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'Email Address'),
                  React.createElement('input', { 
                    type: 'email',
                    value: email, 
                    onChange: (e) => setEmail(e.target.value), 
                    placeholder: 'you@example.com', 
                    className: 'w-full p-3 bg-white/5 border border-white/10 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-white/30 transition-colors' 
                  }),
                  React.createElement('p', { className: 'mt-1 text-xs text-gray-500' }, 'Your eSIM QR code will be sent here')
                ),
                error &&
                  React.createElement('div', { className: 'p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-red-400 text-sm flex items-start gap-2' },
                    React.createElement(AlertCircle, { className: 'w-5 h-5 flex-shrink-0 mt-0.5' }),
                    React.createElement('span', null, error)
                  ),
                React.createElement('button', { 
                  onClick: handlePayment,
                  disabled: orderLoading, 
                  className: 'w-full bg-white text-black px-6 py-3 rounded-lg font-medium hover:bg-gray-100 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2'
                }, 
                  orderLoading && React.createElement(Loader, { className: 'w-4 h-4 animate-spin' }),
                  orderLoading ? 'Processing...' : `Pay $${selectedPlan.price.toFixed(2)}`
                )
              ),
              React.createElement('p', { className: 'mt-6 text-xs text-gray-500 text-center' },
                'By purchasing you agree to our ',
                React.createElement('a', { href: '/terms', className: 'underline hover:text-gray-400' }, 'Terms'),
                ' & ',
                React.createElement('a', { href: '/privacy', className: 'underline hover:text-gray-400' }, 'Privacy Policy')
              )
            )
          ),

        orderResult &&
          React.createElement('div', { className: 'fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4' },
            React.createElement('div', { className: 'w-full max-w-lg bg-gradient-to-br from-green-500/10 to-blue-500/10 border border-white/20 rounded-2xl p-8 shadow-2xl' },
              React.createElement('div', { className: 'text-center mb-6' },
                React.createElement('div', { className: 'w-16 h-16 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-4' },
                  React.createElement(Check, { className: 'w-8 h-8 text-white' })
                ),
                React.createElement('h3', { className: 'text-2xl font-bold' }, 'Payment Successful!'),
                React.createElement('p', { className: 'text-gray-400 mt-2' }, 'Your eSIM has been delivered to your email')
              ),
              React.createElement('div', { className: 'bg-white/5 border border-white/10 rounded-lg p-6 mb-6 space-y-3' },
                React.createElement('div', { className: 'flex justify-between' },
                  React.createElement('span', { className: 'text-gray-400' }, 'Order ID:'),
                  React.createElement('span', { className: 'font-mono text-sm' }, orderResult.orderId?.substring(0, 12) + '...')
                ),
                React.createElement('div', { className: 'flex justify-between' },
                  React.createElement('span', { className: 'text-gray-400' }, 'Plan:'),
                  React.createElement('span', null, selectedPlan?.name)
                ),
                React.createElement('div', { className: 'flex justify-between' },
                  React.createElement('span', { className: 'text-gray-400' }, 'Amount:'),
                  React.createElement('span', { className: 'font-semibold' }, `$${selectedPlan?.price.toFixed(2)}`)
                )
              ),
              React.createElement('div', { className: 'mb-6 p-4 bg-blue-500/10 border border-blue-500/20 rounded-lg' },
                React.createElement('h4', { className: 'font-semibold mb-3' }, 'Next Steps:'),
                React.createElement('ol', { className: 'space-y-2 text-sm list-decimal list-inside' },
                  React.createElement('li', null, 'Open email to find your eSIM QR code'),
                  React.createElement('li', null, 'Go to Settings → Cellular/Mobile Data'),
                  React.createElement('li', null, 'Tap "Add eSIM"'),
                  React.createElement('li', null, 'Scan the QR code'),
                  React.createElement('li', null, 'Follow prompts to activate'),
                  React.createElement('li', null, 'Start using data!')
                )
              ),
              React.createElement('button', { 
                onClick: () => {
                  setOrderResult(null);
                  setShowCheckout(false);
                  window.location.href = '/';
                },
                className: 'w-full bg-white text-black px-6 py-3 rounded-lg font-medium hover:bg-gray-100 transition-colors'
              }, 'Back to Store')
            )
          )
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('app'));
    root.render(React.createElement(RomiSIMApp));
  </script>
</body>
</html>
